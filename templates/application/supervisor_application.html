{% extends 'base_dashboard.html' %} {% load static %} {% block title %}Applications - Thesis Management System{% endblock %} {% block sidebar_menu %} {% include 'supervisor_sidebar.html' %} {% endblock %} {% block content %}
<!-- Page Title -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <h4 class="mb-0 me-3">Applications</h4>
        <a href="{% url 'supervisor_dashboard' %}" class="btn btn-outline-secondary btn-sm"> <i class="mdi mdi-arrow-left me-1"></i>Back to Dashboard </a>
      </div>
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item"><a href="{% url 'supervisor_dashboard' %}">Dashboard</a></li>
          <li class="breadcrumb-item active">Applications</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Filter Summary and Navigation -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <!-- Filter Summary -->
        <div class="row mb-3">
          <div class="col-md-3">
            <div class="text-center">
              <h5 class="mb-1">{{ total_applications }}</h5>
              <small class="text-muted">Total Applications</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="text-center">
              <h5 class="mb-1 text-success">{{ accepted_count }}</h5>
              <small class="text-muted">Accepted</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="text-center">
              <h5 class="mb-1 text-warning">{{ pending_count }}</h5>
              <small class="text-muted">Pending</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="text-center">
              <h5 class="mb-1 text-danger">{{ declined_count }}</h5>
              <small class="text-muted">Declined</small>
            </div>
          </div>
        </div>

        <!-- Filter Buttons -->
        <div class="d-flex justify-content-center">
          <div class="btn-group" role="group">
            <a href="{% url 'supervisor_application' %}" class="btn btn-outline-primary {% if not status_filter %}active{% endif %}"> <i class="mdi mdi-filter-variant me-1"></i>All </a>
            <a href="{% url 'supervisor_application' %}?status=applied" class="btn btn-outline-warning {% if status_filter == 'applied' %}active{% endif %}"> <i class="mdi mdi-clock me-1"></i>Pending </a>
            <a href="{% url 'supervisor_application' %}?status=accepted" class="btn btn-outline-success {% if status_filter == 'accepted' %}active{% endif %}"> <i class="mdi mdi-check-circle me-1"></i>Accepted </a>
            <a href="{% url 'supervisor_application' %}?status=declined" class="btn btn-outline-danger {% if status_filter == 'declined' %}active{% endif %}"> <i class="mdi mdi-close-circle me-1"></i>Declined </a>
          </div>
        </div>

        <!-- Current Filter Info -->
        {% if status_filter %}
        <div class="text-center mt-3">
          <small class="text-muted">
            <i class="mdi mdi-filter me-1"></i>
            Showing: {{ status_filter|title }} applications only
            <span class="badge bg-primary ms-2">{{ applications|length }} found</span>
          </small>
        </div>
        {% else %}
        <div class="text-center mt-3">
          <small class="text-muted">
            <i class="mdi mdi-filter-variant me-1"></i>
            Showing all applications
            <span class="badge bg-primary ms-2">{{ applications|length }} found</span>
          </small>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<div class="row">
  {% if applications %} {% for app in applications %}
  <div class="col-md-6 mb-4">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between mb-2">
          <h5 class="mb-0">{{ app.project.title }}</h5>
          <span class="badge bg-{% if app.status == 'applied' %}warning{% elif app.status == 'accepted' %}success{% else %}danger{% endif %}"> {{ app.status|title }} </span>
        </div>
        {% for member in app.members.all %} {% if member.is_leader %}
        <p class="text-muted mb-3">
          <i class="mdi mdi-account-outline me-1"></i>
          Applied by: {{ member.user.get_full_name }}
        </p>
        {% endif %} {% endfor %}

        <p class="text-muted small mb-3">
          <i class="mdi mdi-clock-outline me-1"></i>
          {{ app.applied_at|date:"M d, Y" }} â€¢
          <span class="badge bg-light text-dark">{{ app.application_type|title }}</span>
        </p>

        <div class="mb-3">
          <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#appModal{{ app.id }}"><i class="mdi mdi-eye me-1"></i>View Application</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Application Modal -->
  <div class="modal fade" id="appModal{{ app.id }}" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">{{ app.project.title }}</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex justify-content-between mb-3">
            <span class="badge bg-{% if app.status == 'applied' %}warning{% elif app.status == 'accepted' %}success{% else %}danger{% endif %}"> {{ app.status|title }} </span>
            <span class="badge bg-light text-dark"> {{ app.application_type|title }} </span>
          </div>

          <p class="small text-muted mb-3">
            <i class="mdi mdi-clock-outline me-1"></i>
            Applied on {{ app.applied_at|date:"M d, Y H:i" }}
          </p>

          <h6 class="mb-2"><i class="mdi mdi-account-group me-1"></i>Team Members</h6>
          <div class="mb-3">
            {% for member in app.members.all %}
            <div class="d-flex align-items-center mb-2">
              <div class="me-2">
                <span class="badge bg-light text-dark"> {{ member.user.get_full_name|slice:":1" }} </span>
              </div>
              <div>
                <span class="small">
                  {{ member.user.get_full_name }} {% if member.is_leader %}
                  <span class="badge bg-info text-white ms-1"> <i class="mdi mdi-crown me-1"></i>Leader </span>
                  {% endif %}
                </span>
              </div>
            </div>
            {% endfor %}
          </div>

          {% if app.message %}
          <h6 class="mb-2"><i class="mdi mdi-message-text me-1"></i>Message</h6>
          <div class="alert alert-light p-2 mb-3 small">{{ app.message }}</div>
          {% endif %}
        </div>
        <div class="modal-footer">
          <a href="{% url 'project_detail' app.project.id %}" class="btn btn-sm btn-outline-primary"> <i class="mdi mdi-eye me-1"></i>View Project </a>
          {% if app.status == 'applied' %}
          <form action="{% url 'decline_application' app.id %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger"><i class="mdi mdi-close me-1"></i>Decline</button>
          </form>
          <form action="{% url 'accept_application' app.id %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-primary"><i class="mdi mdi-check me-1"></i>Accept</button>
          </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-body text-center py-5">
        <i class="mdi mdi-file-document-outline me-3" style="font-size: 2.5rem; color: #6c757d"></i>
        <h5 class="text-muted">No Applications</h5>
        <p class="text-muted mb-0">You haven't received any applications yet.</p>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

<style>
  /* Filter summary styling */
  .filter-summary .text-center h5 {
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  /* Filter buttons styling */
  .btn-group .btn {
    border-radius: 0;
    border-left: none;
  }

  .btn-group .btn:first-child {
    border-left: 1px solid #dee2e6;
    border-top-left-radius: 0.375rem;
    border-bottom-left-radius: 0.375rem;
  }

  .btn-group .btn:last-child {
    border-top-right-radius: 0.375rem;
    border-bottom-right-radius: 0.375rem;
  }

  .btn-group .btn.active {
    font-weight: 600;
  }

  /* Hover effects */
  .btn-group .btn:hover {
    transform: translateY(-1px);
    transition: all 0.2s ease;
  }

  /* Summary card styling */
  .filter-summary .card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  }
</style>
