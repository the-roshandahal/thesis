{% load static %}
{% include 'header.html' %}

<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      
      <div class="row">
        <div class="col-xl-12">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Edit Student</h5>
              

              <form method="POST" action="{% url 'edit_student' student.id %}">
                {% csrf_token %}
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-floating mb-3">
                      <input type="text" name="first_name" class="form-control" 
                             value="{{ student.user.first_name }}" required>
                      <label>First Name</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating mb-3">
                      <input type="text" name="last_name" class="form-control" 
                             value="{{ student.user.last_name }}" required>
                      <label>Last Name</label>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-floating mb-3">
                      <input type="email" name="email" class="form-control" 
                             value="{{ student.user.email }}" required>
                      <label>Email</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating mb-3">
                      <select name="department" class="form-select">
                        <option value="IT" {% if student.department == "IT" %}selected{% endif %}>IT</option>
                        <option value="business" {% if student.department == "business" %}selected{% endif %}>Business</option>
                        <option value="others" {% if student.department == "others" %}selected{% endif %}>Others</option>
                      </select>
                      <label>Department</label>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                      <div class="form-floating mb-3">
                          <input type="password" name="password" class="form-control" id="password"
                                placeholder="Enter password"
                                minlength="8">
                          <label for="password">New Password (leave blank if unchanged)</label>
                          <div class="form-text">
                              Must be at least 8 characters, include a number, an uppercase, and a special character.
                          </div>
                      </div>
                  </div>
                  <div class="col-md-6">
                      <div class="form-floating mb-3">
                          <input type="password" name="password2" class="form-control" id="confirm_password"
                                placeholder="Confirm password">
                          <label for="confirm_password">Confirm Password</label>
                          <div class="form-text text-danger" id="password-error" style="display:none;">
                              Passwords do not match.
                          </div>
                      </div>
                  </div>
              </div>


                <div>
                  <button type="submit" class="btn btn-primary w-md">Update</button>
                </div>
              </form>

            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const password = document.getElementById("password");
    const confirmPassword = document.getElementById("confirm_password");
    const errorText = document.getElementById("password-error");

    function validatePasswords() {
        if (password.value) {
            // If password filled, confirm password becomes required
            confirmPassword.required = true;

            // Check if both match
            if (password.value !== confirmPassword.value) {
                errorText.style.display = "block";
                confirmPassword.setCustomValidity("Passwords do not match");
            } else {
                errorText.style.display = "none";
                confirmPassword.setCustomValidity("");
            }

            // Apply strong password rule only when password is not empty
            password.setAttribute(
                "pattern",
                "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$"
            );
            password.setAttribute(
                "title",
                "Must contain at least 8 characters, one uppercase, one lowercase, one number, and one special character."
            );
        } else {
            // If password is empty, remove rules
            confirmPassword.required = false;
            confirmPassword.setCustomValidity("");
            password.removeAttribute("pattern");
            password.removeAttribute("title");
            errorText.style.display = "none";
        }
    }

    password.addEventListener("input", validatePasswords);
    confirmPassword.addEventListener("input", validatePasswords);
});
</script>


{% include 'footer.html' %}
