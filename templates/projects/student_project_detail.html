{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ project.title }} - KOI Thesis Management System</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <style>
      :root {
        --primary-color: #2563eb;
        --secondary-color: #1e40af;
        --accent-color: #3b82f6;
        --success-color: #16a34a;
        --warning-color: #ca8a04;
        --danger-color: #dc2626;
        --info-color: #0891b2;
        --text-dark: #1f2937;
        --text-light: #6b7280;
        --bg-light: #f8fafc;
        --bg-white: #ffffff;
        --border-color: #e5e7eb;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: var(--text-dark);
      }

      .page-container {
        background: var(--bg-white);
        border-radius: 24px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        margin: 20px;
        overflow: hidden;
      }

      .page-header {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        padding: 40px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .page-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
      }

      .header-content {
        position: relative;
        z-index: 2;
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }

      .page-subtitle {
        font-size: 1.1rem;
        opacity: 0.9;
        margin-bottom: 2rem;
      }

      .supervisor-info {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-bottom: 1rem;
      }

      .supervisor-avatar {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: 600;
        border: 3px solid rgba(255, 255, 255, 0.3);
      }

      .supervisor-details h5 {
        margin: 0;
        font-weight: 600;
      }

      .supervisor-details p {
        margin: 0;
        opacity: 0.8;
        font-size: 0.9rem;
      }

      .page-content {
        padding: 40px;
      }

      .project-section {
        background: var(--bg-white);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid var(--border-color);
      }

      .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .project-description {
        line-height: 1.7;
        color: var(--text-dark);
        font-size: 1rem;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
      }

      .info-card {
        background: var(--bg-light);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border-color);
      }

      .info-card h6 {
        color: var(--primary-color);
        margin-bottom: 12px;
        font-weight: 600;
      }

      .badge-custom {
        background: rgba(37, 99, 235, 0.1);
        color: var(--primary-color);
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        margin: 2px;
        display: inline-block;
      }

      .files-section {
        margin-bottom: 24px;
      }

      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 16px;
        background: var(--bg-light);
        border-radius: 8px;
        margin-bottom: 8px;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        text-decoration: none;
        color: inherit;
        cursor: pointer;
      }

      .file-item:hover {
        background: rgba(37, 99, 235, 0.05);
        border-color: var(--primary-color);
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.1);
      }

      .file-item:active {
        transform: translateY(0);
      }

      .file-info {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .file-icon {
        color: var(--danger-color);
        font-size: 1.2rem;
      }

      .file-name {
        font-weight: 500;
        color: var(--text-dark);
      }

      .file-size {
        color: var(--text-light);
        font-size: 0.85rem;
      }

      .application-section {
        background: linear-gradient(135deg, rgba(37, 99, 235, 0.05) 0%, rgba(59, 130, 246, 0.05) 100%);
        border-radius: 16px;
        padding: 32px;
        text-align: center;
        border: 2px dashed var(--primary-color);
      }

      .btn-apply {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 12px 32px;
        border-radius: 12px;
        text-decoration: none;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
      }

      .btn-apply:hover {
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
      }

      .btn-back {
        background: var(--bg-light);
        color: var(--text-dark);
        padding: 8px 16px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: all 0.3s ease;
        border: 1px solid var(--border-color);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 24px;
      }

      .btn-back:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      .alert {
        border-radius: 12px;
        border: none;
        padding: 16px 20px;
        margin-bottom: 24px;
      }

      .alert-success {
        background: rgba(22, 163, 74, 0.1);
        color: var(--success-color);
        border-left: 4px solid var(--success-color);
      }

      .alert-info {
        background: rgba(8, 145, 178, 0.1);
        color: var(--info-color);
        border-left: 4px solid var(--info-color);
      }

      .alert-warning {
        background: rgba(202, 138, 4, 0.1);
        color: var(--warning-color);
        border-left: 4px solid var(--warning-color);
      }

      .floating-shapes {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        overflow: hidden;
        pointer-events: none;
      }

      .shape {
        position: absolute;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        animation: float 6s ease-in-out infinite;
      }

      .shape:nth-child(1) {
        width: 60px;
        height: 60px;
        top: 20%;
        right: 20%;
        animation-delay: 0s;
      }

      .shape:nth-child(2) {
        width: 40px;
        height: 40px;
        bottom: 30%;
        left: 15%;
        animation-delay: 2s;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        50% {
          transform: translateY(-15px) rotate(180deg);
        }
      }

      @media (max-width: 768px) {
        .page-container {
          margin: 10px;
        }

        .page-header {
          padding: 30px 20px;
        }

        .page-content {
          padding: 20px;
        }

        .page-title {
          font-size: 2rem;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }

        .supervisor-info {
          flex-direction: column;
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    {% include 'student_navigation.html' %}

    <div class="page-container">
      <!-- Page Header -->
      <div class="page-header">
        <div class="floating-shapes">
          <div class="shape"></div>
          <div class="shape"></div>
        </div>

        <div class="header-content">
          <h1 class="page-title">{{ project.title }}</h1>
          <p class="page-subtitle">Project Details and Application</p>

          <div class="supervisor-info">
            <div class="supervisor-avatar">{{ project.supervisor.first_name|slice:":1"|upper }}{{ project.supervisor.last_name|slice:":1"|upper }}</div>
            <div class="supervisor-details">
              <h5>Dr. {{ project.supervisor.first_name }} {{ project.supervisor.last_name }}</h5>
              <p>{{ project.supervisor.supervisor.department|default:"Department" }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Page Content -->
      <div class="page-content">
        <!-- Back Button -->
        <a href="{% url 'student_projects' %}" class="btn-back">
          <i class="fas fa-arrow-left"></i>
          Back to Projects
        </a>

        <!-- Messages -->
        {% if messages %} {% for message in messages %}
        <div class="alert alert-{% if message.tags == 'error' %}warning{% elif message.tags == 'success' %}success{% else %}info{% endif %} alert-dismissible fade show" role="alert">
          <i class="fas fa-{% if message.tags == 'error' %}exclamation-circle{% elif message.tags == 'success' %}check-circle{% else %}info-circle{% endif %} me-2"></i>
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %} {% endif %}

        <!-- Project Availability Status -->
        {% if is_available %}
        <div class="alert alert-success" role="alert">
          <i class="fas fa-check-circle me-2"></i>
          <strong>Project Available!</strong> This project is currently accepting applications from students.
        </div>
        {% else %}
        <div class="alert alert-warning" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          <strong>Project Not Available</strong> This project is no longer accepting applications as it has already been assigned.
        </div>
        {% endif %}

        <!-- Project Description -->
        <div class="project-section">
          <h3 class="section-title">
            <i class="fas fa-file-alt"></i>
            Project Description
          </h3>
          <div class="project-description">{{ project.description|safe }}</div>
        </div>

        <!-- Project Information -->
        <div class="info-grid">
          <!-- Topic Areas -->
          <div class="info-card">
            <h6><i class="fas fa-tags me-2"></i>Topic Areas</h6>
            {% if project.areas.all %}
            <div class="d-flex flex-wrap gap-2">
              {% for area in project.areas.all %}
              <span class="badge-custom">{{ area.name }}</span>
              {% endfor %}
            </div>
            {% else %}
            <p class="text-muted mb-0">No areas defined</p>
            {% endif %}
          </div>

          <!-- Topic Type -->
          <div class="info-card">
            <h6><i class="fas fa-list-check me-2"></i>Project Type</h6>
            {% if project.project_type %}
            <span class="badge-custom">{{ project.project_type }}</span>
            {% else %}
            <p class="text-muted mb-0">No type specified</p>
            {% endif %}
          </div>

          <!-- Created Date -->
          <div class="info-card">
            <h6><i class="fas fa-calendar me-2"></i>Created</h6>
            <p class="mb-0">{{ project.created|date:"F j, Y" }}</p>
          </div>
        </div>

        <!-- Prerequisites -->
        {% if project.prerequisites %}
        <div class="project-section">
          <h3 class="section-title">
            <i class="fas fa-key"></i>
            Prerequisites
          </h3>
          <div class="project-description">{{ project.prerequisites }}</div>
        </div>
        {% endif %}

        <!-- Project Files -->
        {% if project.files.exists %}
        <div class="project-section">
          <h3 class="section-title">
            <i class="fas fa-file-pdf"></i>
            Project Files
          </h3>
          <div class="files-section">
            {% for f in project.files.all %}
            <a href="{{ f.file.url }}" target="_blank" rel="noopener noreferrer" class="file-item">
              <div class="file-info">
                <i class="fas fa-file-pdf file-icon"></i>
                <span class="file-name">{{ f.display_name|default:f.file.name|cut:"uploads/" }}</span>
              </div>
              <span class="file-size">{{ f.file.size|filesizeformat }}</span>
            </a>
            {% endfor %}
          </div>
        </div>
        {% endif %}

        <!-- Application Section -->
        <div class="project-section">
          <h3 class="section-title">
            <i class="fas fa-paper-plane"></i>
            Apply to Project
          </h3>

          {% if has_applied %}
          <!-- Check if user has an accepted application -->
          {% if application_status == 'accepted' %}
          <div class="alert alert-success" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <strong>Application Accepted!</strong> Your application for this project has been approved. <br /><small class="text-muted">You cannot apply to other projects while this one is active.</small>
          </div>
          {% elif application_status == 'applied' %}
          <div class="alert alert-info" role="alert">
            <i class="fas fa-clock me-2"></i>
            <strong>Application Pending</strong> You have already applied to this project and it's under review. <br /><small class="text-muted">Please wait for the supervisor's decision.</small>
          </div>
          {% else %}
          <div class="alert alert-warning" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <strong>Application Status Unknown</strong> Please contact support if you believe this is an error.
          </div>
          {% endif %} {% else %}
          <!-- Show apply button if user hasn't applied -->
          <div class="application-section">
            {% if is_available and not has_accepted_application_anywhere %}
            <h4 class="mb-3">Interested in this project?</h4>
            <p class="text-muted mb-4">Submit your application below to get started with your thesis journey.</p>
            <a href="{% url 'apply_to_project' project.id %}" class="btn-apply">
              <i class="fas fa-paper-plane"></i>
              Apply to Project
            </a>
            <p class="text-muted mt-3 mb-0">
              <small>
                <i class="fas fa-info-circle me-1"></i>
                You can apply individually or as part of a group
              </small>
            </p>
            {% elif has_accepted_application_anywhere %}
            <div class="alert alert-warning" role="alert">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <strong>Application Accepted!</strong> You have an accepted application to another project. <br /><small class="text-muted">You cannot apply to additional projects while your current application is active. Please complete your current project first.</small>
            </div>
            {% else %}
            <div class="alert alert-warning" role="alert">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <strong>Project Not Available</strong> This project is no longer accepting applications as it has already been assigned to students.
            </div>
            <p class="text-muted mt-3 mb-0">
              <small>
                <i class="fas fa-info-circle me-1"></i>
                Please browse other available projects
              </small>
            </p>
            {% endif %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
