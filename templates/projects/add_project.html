{% extends 'base_dashboard.html' %} {% load static %} {% block title %}Add Project - Thesis Management System{% endblock %} {% block sidebar_menu %} {% include 'supervisor_sidebar.html' %} {% endblock %} {% block content %}
<!-- Page Title -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-flex align-items-center justify-content-between">
      <h4 class="mb-0">Add Project</h4>
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item"><a href="{% url 'supervisor_dashboard' %}">Dashboard</a></li>
          <li class="breadcrumb-item active">Add Project</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<div class="col-lg-12">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title mb-4">Add Project</h4>

      {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
      {% endif %}

      <form id="projectForm" method="POST" action="{% url 'add_project' %}" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="row">
          <div class="col-lg-6">
            <div class="mb-3">
              <label class="form-label">Project Title</label>
              <input type="text" class="form-control" name="project_title" required />
            </div>
          </div>
          <div class="col-lg-6">
            <div class="mb-3">
              <label class="form-label">Project Type</label>
              <select class="form-select" name="project_type" required>
                <option value="Research">Research</option>
                <option value="Development">Development</option>
                <option value="R and D">R and D</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-lg-6">
            <div class="mb-3">
              <label class="form-label">Pre-requisites</label>
              <input type="text" class="form-control" name="prerequisites" required />
            </div>
          </div>
          <div class="col-lg-6">
            <label class="form-label">Topic Areas</label>
            <div class="input-group mb-2">
              <input type="text" id="topicAreaInput" class="form-control" placeholder="E.g., AI, Web Development" />
              <button class="btn btn-primary" type="button" onclick="addTopicArea()">Add</button>
            </div>
            <div id="topicAreaList" class="mb-3"></div>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea id="description" name="description" class="form-control" rows="8" placeholder="Enter detailed project description, requirements, objectives, and any other relevant information..."></textarea>
        </div>

        <div class="mb-4">
          <label class="form-label">Project Files</label>

          <!-- Sample File -->
          <div class="mb-3">
            <label class="form-label">Sample File (PDF)</label>
            <input type="file" id="sampleFileInput" class="form-control" accept=".pdf" />
            <small class="text-muted">Upload a sample file for students to reference</small>
          </div>

          <!-- Assessment Details -->
          <div class="mb-3">
            <label class="form-label">Assessment Details (PDF)</label>
            <input type="file" id="assessmentFileInput" class="form-control" accept=".pdf" />
            <small class="text-muted">Upload assessment criteria and details</small>
          </div>

          <div id="filePreview" class="mt-2"></div>
        </div>

        <div class="mb-3">
          <label class="form-label">Reference Links</label>
          <div class="input-group mb-2">
            <input type="url" id="linkInput" class="form-control" placeholder="https://example.com" />
            <button class="btn btn-primary" type="button" onclick="addLink()">Add Link</button>
          </div>
          <div id="linkList" class="mb-3"></div>
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">Submit</button>
          <a href="{% url 'project_supervisor' %}" class="btn btn-secondary">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // --- Global Variables ---
  let sampleFile = null; // Sample file
  let assessmentFile = null; // Assessment details file

  // --- Render File Previews Function ---
  function renderFilePreviews() {
    const preview = document.getElementById("filePreview");
    // Clear existing previews
    preview.innerHTML = "";

    // Render each file
    if (sampleFile) {
      const div = document.createElement("div");
      div.className = "d-flex align-items-center justify-content-between p-2 border rounded mb-2";
      div.innerHTML = `
        <div class="flex-grow-1">
          <input type="text" class="form-control form-control-sm" 
                 value="Sample File" 
                 onchange="updateCustomFileName(0, this.value)"
                 maxlength="255">
          <small class="text-muted d-block">${(sampleFile.size / (1024 * 1024)).toFixed(2)} MB</small>
        </div>
        <button type="button" class="btn btn-sm btn-danger mt-2 mt-md-0" onclick="removeFilePreview(this, 0)">Remove</button>
      `;
      preview.appendChild(div);
    }

    if (assessmentFile) {
      const div = document.createElement("div");
      div.className = "d-flex align-items-center justify-content-between p-2 border rounded mb-2";
      div.innerHTML = `
        <div class="flex-grow-1">
          <input type="text" class="form-control form-control-sm" 
                 value="Assessment Details" 
                 onchange="updateCustomFileName(1, this.value)"
                 maxlength="255">
          <small class="text-muted d-block">${(assessmentFile.size / (1024 * 1024)).toFixed(2)} MB</small>
        </div>
        <button type="button" class="btn btn-sm btn-danger mt-2 mt-md-0" onclick="removeFilePreview(this, 1)">Remove</button>
      `;
      preview.appendChild(div);
    }
  }

  // --- File Input Change Listeners ---
  document.addEventListener("DOMContentLoaded", function () {
    // Sample file input
    document.getElementById("sampleFileInput").addEventListener("change", function (e) {
      if (e.target.files.length > 0) {
        sampleFile = e.target.files[0];
        console.log("Sample file selected:", sampleFile.name);
        renderFilePreviews(); // Update the preview
      }
    });

    // Assessment file input
    document.getElementById("assessmentFileInput").addEventListener("change", function (e) {
      if (e.target.files.length > 0) {
        assessmentFile = e.target.files[0];
        console.log("Assessment file selected:", assessmentFile.name);
        renderFilePreviews(); // Update the preview
      }
    });

    // Initial render of file previews
    renderFilePreviews();
  });

  // --- Remove File from Preview and selectedFiles Array ---
  function removeFilePreview(button, indexToRemove) {
    if (indexToRemove === 0) {
      sampleFile = null;
    } else if (indexToRemove === 1) {
      assessmentFile = null;
    }
    renderFilePreviews(); // Re-render to update indices and display
  }

  // Add Topic Area (remains the same)
  function addTopicArea() {
    const input = document.getElementById("topicAreaInput");
    const value = input.value.trim();

    if (value) {
      const list = document.getElementById("topicAreaList");
      const div = document.createElement("div");
      div.className = "alert alert-secondary alert-dismissible fade show mb-2";
      div.innerHTML = `
        ${value}
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
        <input type="hidden" name="project_areas[]" value="${value}">
      `;
      list.appendChild(div);
      input.value = "";
    }
  }

  // Add Link (remains the same)
  function addLink() {
    const input = document.getElementById("linkInput");
    const value = input.value.trim();

    if (value) {
      const list = document.getElementById("linkList");
      const div = document.createElement("div");
      div.className = "alert alert-info alert-dismissible fade show mb-2";
      div.innerHTML = `
        <a href="${value}" target="_blank">${value}</a>
        <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
        <input type="hidden" name="project_links[]" value="${value}">
      `;
      list.appendChild(div);
      input.value = "";
    }
  }
</script>
{% endblock %}
