{% extends 'base_dashboard.html' %} {% load static %} {% block title %}Project Submissions - Thesis Management System{% endblock %} {% block sidebar_menu %} {% if user_is_supervisor %} {% include 'supervisor_sidebar.html' %} {% elif user_is_admin %} {% include 'admin_sidebar.html' %} {% else %}
<!-- Student sidebar or no sidebar -->
{% endif %} {% endblock %} {% block content %}
<!-- Page Title -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-flex align-items-center justify-content-between">
      <h4 class="mb-0">Project Submissions</h4>
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          {% if user_is_supervisor %}
          <li class="breadcrumb-item"><a href="{% url 'supervisor_dashboard' %}">Dashboard</a></li>
          {% elif user_is_admin %}
          <li class="breadcrumb-item"><a href="{% url 'admin_dashboard' %}">Dashboard</a></li>
          {% endif %}
          <li class="breadcrumb-item"><a href="{% url 'grading:grading' %}">Grading</a></li>
          <li class="breadcrumb-item active">{{ project.title|truncatechars:30 }}</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Assessment Header Section -->
<div class="card shadow-sm mb-4">
  <div class="card-header py-3 bg-primary text-white">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h4 class="m-0 font-weight-bold">
          <i class="mdi mdi-clipboard-check me-2"></i>
          {{ submissions.0.assignment.title|default:"Assessment" }}
        </h4>
      </div>
      <div class="text-right">
        {% if avg_grade %}
        <span class="badge badge-light p-2"> Average Grade: {{ avg_grade|floatformat:1 }}/{{ submissions.0.assignment.total_marks }} </span>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="card-body bg-light">
    <div class="row">
      <div class="col-md-6">
        <div class="assessment-detail-item">
          <h5 class="detail-label">Weight</h5>
          <p class="detail-value">{{ submissions.0.assignment.weight }}%</p>
        </div>
      </div>
      <div class="col-md-6">
        <div class="assessment-detail-item">
          <h5 class="detail-label">Due Date</h5>
          <p class="detail-value">{{ submissions.0.assignment.due_date }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Submissions Table Section -->
<div class="card shadow-sm mb-4">
  <div class="card-header py-3">
    <h5 class="m-0 font-weight-bold text-primary">
      <i class="mdi mdi-account-group me-2"></i>
      Student Submissions for {{ project.title }}
    </h5>
  </div>
  <div class="card-body">
    {% if submissions %}
    <div class="table-responsive">
      <table class="table table-bordered table-hover" id="submissionsTable">
        <thead class="thead-dark">
          <tr>
            <th>#</th>
            <th>Student</th>
            <th>Submitted</th>
            <th>Files</th>
            <th>Grade</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for submission in submissions %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ submission.submitted_by.get_full_name|default:submission.submitted_by.username }}</td>
            <td>{{ submission.submitted_at|date:"M d, Y H:i" }}</td>
            <td>
              {% if submission.files.all %}
              <div class="file-list">
                {% for file in submission.files.all %}
                <a href="{{ file.file.url }}" target="_blank" class="btn btn-sm btn-outline-primary mb-1"> <i class="mdi mdi-file-download me-1"></i> File {{ forloop.counter }} </a>
                {% endfor %}
              </div>
              {% else %}
              <span class="text-muted">No files</span>
              {% endif %}
            </td>
            <td>
              {% if submission.grades_received %}
              <span class="grade-value"> {{ submission.grades_received }}/{{ submission.assignment.weight }} </span>
              {% else %}
              <span class="text-muted">Pending</span>
              {% endif %}
            </td>
            <td>
              {% if submission.is_late %}
              <span class="badge badge-danger">Late</span>
              {% else %}
              <span class="badge badge-success">On Time</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'grade_submission' submission.id %}" class="btn btn-sm btn-primary"> <i class="mdi mdi-pencil me-1"></i> Grade </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-center py-4">
      <i class="mdi mdi-inbox-outline me-3" style="font-size: 3rem; color: #6c757d"></i>
      <h5 class="text-muted">No Submissions Yet</h5>
      <p class="text-muted">Students haven't submitted their work for this assessment yet.</p>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}

<style>
  .assessment-detail-item {
    padding: 10px;
    border-radius: 5px;
    background: white;
    height: 100%;
  }
  .detail-label {
    font-size: 0.9rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
  }
  .detail-value {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0;
  }
  .grade-value {
    font-weight: 600;
  }
  .card-header.bg-primary {
    border-radius: 0.35rem 0.35rem 0 0 !important;
  }
  .card-body.bg-light {
    border-radius: 0 0 0.35rem 0.35rem !important;
  }
</style>

<!-- JavaScript (keep your existing script) -->
<script>
  $(document).ready(function () {
    $(".view-files").click(function () {
      var submissionId = $(this).data("submission-id");
      $("#filePreviewContent").load("/submission/" + submissionId + "/files/");
      $("#filePreviewModal").modal("show");
    });
  });
</script>
